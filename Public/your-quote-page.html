<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricing & Get a Quote</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #6b7280; /* Gray-500 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: #4b5563; /* Gray-600 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 flex items-center justify-center min-h-screen p-4">

<!-- Quote Form Container -->
    <div class="w-full bg-white rounded-2xl shadow-xl overflow-hidden">
        <!-- Form and Content Section -->
        <div class="p-6 md:p-8 space-y-8">
    
                <!-- Information Panel (from original form) -->
                <div class="bg-blue-50 border border-blue-200 text-blue-800 p-4 rounded-lg shadow-sm mt-8">
                    <p class="font-medium">Please note:</p>
                    <p class="text-sm mt-1">This is an estimated quote. The final price may vary based on audio quality, number of speakers, and specific requirements. We will provide a final, fixed quote after reviewing your file.</p>
                </div>

                <!-- The main form -->
                <form id="quote-form" class="space-y-6 mt-6" method="POST" action="/submit-quote" enctype="multipart/form-data">
                    
                    <!-- Client Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="company" class="block text-sm font-medium text-gray-700">Company</label>
                            <input type="text" id="company" name="company" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700">Name and Surname</label>
                            <input type="text" id="name" name="name" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                            <input type="email" id="email" name="email" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="contact_no" class="block text-sm font-medium text-gray-700">Contact Number</label>
                            <input type="tel" id="contact_no" name="contact_no" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                    </div>

                    <!-- Transcription Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="service_type" class="block text-sm font-medium text-gray-700">Service Type</label>
                            <select id="service_type" name="service_type" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <option value="general">General transcription</option>
                                <option value="legal">Legal transcription</option>
                                <option value="medical">Medical transcription</option>
                                <option value="market-research">Focus groups</option>
                                <!-- New Option for Editing Service -->
                                <option value="editing">Editing service</option>
                            </select>
                        </div>
                        <div>
                            <label for="turnaround_time" class="block text-sm font-medium text-gray-700">Turnaround Time</label>
                            <select id="turnaround_time" name="turnaround_time" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="length" class="block text-sm font-medium text-gray-700">Audio/Video Length (in minutes)</label>
                        <input type="number" id="length" name="length" min="1" value="1" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    
                    <!-- Additional Charges Checkboxes -->
                    <div class="space-y-4">
                        <p class="text-sm font-medium text-gray-700">Add-On Charges:</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center">
                                <input id="multiple_speakers" name="multiple_speakers" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="multiple_speakers" class="ml-2 block text-sm text-gray-700">Multiple speakers (3+)</label>
                            </div>
                            <div class="flex items-center">
                                <input id="poor_audio" name="poor_audio" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="poor_audio" class="ml-2 block text-sm text-gray-700">Heavy accents / poor audio quality</label>
                            </div>
                            <div class="flex items-center">
                                <input id="verbatim" name="verbatim" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="verbatim" class="ml-2 block text-sm text-gray-700">Verbatim transcription</label>
                            </div>
                            <div class="flex items-center">
                                <input id="time_stamping" name="time_stamping" type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <label for="time_stamping" class="ml-2 block text-sm text-gray-700">Time-stamping</label>
                            </div>
                        </div>
                    </div>

                    <!-- File Upload -->
                    <div>
                        <label for="file_upload" class="block text-sm font-medium text-gray-700">Upload Your File</label>
                        <p class="text-xs text-gray-500 mt-1 mb-2">
                            Supported formats: .mp3, .mp4, .wav, .mov, etc. Max file size: 500MB.
                        </p>
                        <input type="file" id="file_upload" name="file_upload" required 
                               accept="audio/*,video/*,.mp3,.mp4,.wav,.mov,.avi,.wmv,.m4a,.aac,.flv,.mkv" 
                               class="block w-full text-sm text-gray-500
                            file:mr-4 file:py-2 file:px-4
                            file:rounded-full file:border-0
                            file:text-sm file:font-semibold
                            file:bg-blue-50 file:text-blue-700
                            hover:file:bg-blue-100 cursor-pointer" />
                    </div>

                    <!-- Quote Display & Message Box -->
                    <div id="quote-display" class="bg-green-50 border border-green-200 text-green-800 p-4 rounded-lg shadow-sm hidden">
                        <p class="text-sm font-semibold">Your Estimated Quote:</p>
                        <div class="text-3xl font-bold mt-1 text-green-900">R<span id="quote-price">0.00</span></div>
                        <p class="text-xs text-green-600 mt-2" id="quote-message">The final price is subject to a review of your file.</p>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" id="submit-btn" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Submit Quote Request
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const quoteForm = document.getElementById('quote-form');
            const serviceTypeSelect = document.getElementById('service_type');
            const turnaroundTimeSelect = document.getElementById('turnaround_time');
            const quoteDisplay = document.getElementById('quote-display');
            const quotePriceSpan = document.getElementById('quote-price');
            const quoteMessage = document.getElementById('quote-message');
            const submitBtn = document.getElementById('submit-btn');

            // Define all pricing in a nested structure
            const pricing = {
                'general': {
                    'basic': { label: 'Basic (3–4 day turnaround)', rate: 12.50 },
                    'standard': { label: 'Standard (48-72 hrs)', rate: 15.00 },
                    'express': { label: 'Express (24 hrs)', rate: 18.00 },
                    'urgent': { label: 'Urgent (Same day)', rate: 20.00 },
                },
                'legal': {
                    'basic': { label: 'Basic (3–4 day turnaround)', rate: 18.00 },
                    'standard': { label: 'Standard (48–72 hrs)', rate: 20.00 },
                    'express': { label: 'Express (24 hrs)', rate: 22.00 },
                    'urgent': { label: 'Urgent (Same day)', rate: 25.00 },
                },
                'medical': {
                    'basic': { label: 'Basic (3–4 day turnaround)', rate: 16.00 },
                    'standard': { label: 'Standard (48–72 hrs)', rate: 18.00 },
                    'express': { label: 'Express (24 hrs)', rate: 20.00 },
                    'urgent': { label: 'Urgent (Same day)', rate: 22.00 },
                },
                'market-research': {
                    'basic': { label: 'Basic (3–4 day turnaround)', rate: 15.00 },
                    'standard': { label: 'Standard (48–72 hrs)', rate: 16.00 },
                    'express': { label: 'Express (24 hrs)', rate: 18.00 },
                    'urgent': { label: 'Urgent (Same day)', rate: 20.00 },
                },
                // New pricing for Editing Service
                'editing': {
                    'basic': { label: 'Basic (3-4 day turnaround)', rate: 10.00 },
                    'standard': { label: 'Standard (48 - 72hrs)', rate: 12.50 },
                    'express': { label: 'Express (24 hrs)', rate: 14.00 },
                    'urgent': { label: 'Urgent (Same day)', rate: 16.00 },
                }
            };

            const addOns = {
                multipleSpeakers: 2.00,
                poorAudio: 2.00,
                verbatim: 0.20, // 20%
                timeStamping: 2.00,
            };

            // Function to populate the turnaround time dropdown based on the service type
            const populateTurnaroundTimes = () => {
                const selectedService = serviceTypeSelect.value;
                const times = pricing[selectedService];
                turnaroundTimeSelect.innerHTML = ''; // Clear previous options

                for (const key in times) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = times[key].label;
                    turnaroundTimeSelect.appendChild(option);
                }
            };
            
            // Function to calculate and update the quote
            const updateQuote = () => {
                const serviceType = serviceTypeSelect.value;
                const turnaroundTime = turnaroundTimeSelect.value;
                const length = parseFloat(document.getElementById('length').value);
                
                // Checkbox states
                const isMultipleSpeakers = document.getElementById('multiple_speakers').checked;
                const isPoorAudio = document.getElementById('poor_audio').checked;
                const isVerbatim = document.getElementById('verbatim').checked;
                const isTimeStamping = document.getElementById('time_stamping').checked;

                // Ensure inputs are valid numbers and selections are made
                if (isNaN(length) || length <= 0 || !pricing[serviceType] || !pricing[serviceType][turnaroundTime]) {
                    quoteDisplay.classList.add('hidden');
                    return;
                }

                // Get the base rate from the nested pricing structure
                let price = pricing[serviceType][turnaroundTime].rate * length;

                // Apply add-on charges
                let addOnCost = 0;
                if (isMultipleSpeakers) {
                    addOnCost += addOns.multipleSpeakers;
                }
                if (isPoorAudio) {
                    addOnCost += addOns.poorAudio;
                }
                if (isTimeStamping) {
                    addOnCost += addOns.timeStamping;
                }
                
                price += addOnCost * length;

                // Apply verbatim percentage after all other calculations
                if (isVerbatim) {
                    price *= (1 + addOns.verbatim);
                }
                
                // Display the quote
                quotePriceSpan.textContent = price.toFixed(2);
                quoteDisplay.classList.remove('hidden');
            };

            // Add event listeners
            serviceTypeSelect.addEventListener('change', () => {
                populateTurnaroundTimes();
                updateQuote();
            });
            turnaroundTimeSelect.addEventListener('change', updateQuote);
            document.getElementById('length').addEventListener('input', updateQuote);
            document.getElementById('multiple_speakers').addEventListener('change', updateQuote);
            document.getElementById('poor_audio').addEventListener('change', updateQuote);
            document.getElementById('verbatim').addEventListener('change', updateQuote);
            document.getElementById('time_stamping').addEventListener('change', updateQuote);

            // Handle form submission
            quoteForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Show loading state
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;
                
                try {
                    const formData = new FormData(quoteForm);
                    
                    const response = await fetch('/submit-quote', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        // Success
                        quoteMessage.textContent = "Thank you! We have received your request and will contact you shortly with a final quote.";
                        quoteMessage.classList.add('text-lg', 'text-center', 'font-semibold');
                        quotePriceSpan.parentNode.classList.add('hidden');
                        quoteDisplay.classList.remove('hidden');
                        
                        // Reset form
                        quoteForm.reset();
                        populateTurnaroundTimes();
                        updateQuote();
                    } else {
                        throw new Error('Server error');
                    }
                } catch (error) {
                    console.error('Error submitting form:', error);
                    alert('There was an error submitting your request. Please try again.');
                } finally {
                    // Reset button state
                    submitBtn.textContent = 'Submit Quote Request';
                    submitBtn.disabled = false;
                }
            });
            
            // Initial setup on page load
            populateTurnaroundTimes();
            updateQuote();
        });
    </script>

</body>
</html>